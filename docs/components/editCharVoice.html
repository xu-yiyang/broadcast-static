<div class="gb-form">
	<form class="layui-form" action="">
		<div class="newform">
			<p class="newform-tit"><i class="iconfont icon-shangchuan"></i>上传文字语音</p>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit">文本转换</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit">文本</p>
					<div class="oneimp">
						<textarea id="imparea" class="imparea" maxlength="3000" onfocus="if(this.value == defaultValue){this.value = '';this.style.color = '#333'}" onblur="if(!value){this.value = defaultValue;this.style.color = '#ccc'}"></textarea>
						<span class="area-count"><span class="countnew">0</span>/3000</span>
					</div>
					<input type="button" value="转成音频" class="toswitch" />
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit">本地上传</p>
				</div>
				<div class="oneitem-cont">
					<div class="locupload">
						<div class="touploading">
							<input type="file" class="fileup" accept="audio/*,video/*" data-type="loading"  id="fileup"/>
							<input type="button" value="本地上传" class="uplbtn" />
						</div>
						<span class="itemexp"><i class="iconfont icon-iconfontjinggao"></i>音频大小不超过5M</span>
					</div>
					<p class="gb-linetw"></p>
					<div class="onearea">
						<div class="thefile">
							<div class="filename"><i class="iconfont icon-1"></i><span class="thename">杭州台风预警杭州台风预警.mp3</span></div>
							<div class="filebtn">
								<input type="button" value="格式转换" class="foconv-btn"/>
								<input type="button" value="转成文本" class="wordconv-btn" data-type="loading"/>
								<input type="button" value="删除" class="todel-btn"/>
							</div>
						</div>
						<div class="oneimp">
							<div class="tomat theprog-bar">
								<div class="layui-progress layui-progress-big" lay-filter="demo">lay-showpercent="true"
								  <div class="layui-progress-bar" lay-percent="0%"></div>layui-bg-red
								</div>
								<p class="forword">转换中...</p>
							</div>
							<textarea id="imparea" class="imparea" onblur="if(!value){this.value = defaultValue;this.style.color = '#ccc'}">转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本</textarea>
						</div>
					</div>
					<div class="onearea">
						<div class="thefile">
							<div class="filename"><i class="iconfont icon-1"></i><span class="thename">杭州台风预警杭州台风预警.mp3</span></div>
							<div class="filebtn">
								<input type="button" value="格式转换" class="foconv-btn"/>
								<input type="button" value="转成文本" class="wordconv-btn" data-type="loading"/>
								<input type="button" value="删除" class="todel-btn"/>
							</div>
						</div>
						<div class="oneimp">
							<div class="tomat theprog-bar">
								<div class="layui-progress layui-progress-big" lay-filter="demo">lay-showpercent="true"
								  <div class="layui-progress-bar" lay-percent="0%"></div>layui-bg-red
								</div>
								<p class="forword">转换中...</p>
							</div>
							<textarea id="imparea" class="imparea" onblur="if(!value){this.value = defaultValue;this.style.color = '#ccc'}">转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本</textarea>
						</div>
					</div>
					<div class="tomat" id="upthefile">
						<p class="uplword"><span class="thename">杭州市台风预警音频.mp3</span>上传中</p>
						<div class="layui-progress layui-progress-big" lay-filter="demo" lay-showpercent="true">
							<div class="layui-progress-bar" lay-percent="0%"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="tocreat">
				<input type="button" value="保存" class="tocreatbtn" />
			</div>
			<p class="botword">© 2017-2018 浙江省应急广播平台</p>
		</div>
		<div class="popwindow"></div>
		<div class="choose">
			<p class="choword">确定删除此任务消息吗？</p>
			<div class="chobtn">
				<input type="button" value="删除" class="chopri cho-delete" />
				<input type="button" value="取消" class="cho-cancel" />
			</div>
			<span class="triangle"><em></em></span>
		</div>
		<div class="toshift">
			<p class="poptit">格式转换</p>
			<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
			<div class="uncont">
				<div class="format">
					<span class="matit">当前格式：</span>
					<span class="themat">mp3</span>
				</div>
				<div class="format">
					<span class="matit">目标格式：</span>
					<div class="matchoose">
						<ul class="matlist">
							<li>
								<span class="matype">格式一</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matone" checked="checked" />
									<label for="matone"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式二</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matwo" />
									<label for="matwo"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式三</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="mathr" />
									<label for="mathr"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式四</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matfou" />
									<label for="matfou"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式五</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matfiv" />
									<label for="matfiv"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式六</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matsix" />
									<label for="matsix"></label>
								</div>
							</li>
						</ul>
					</div>
				</div>
				<div class="tomat">
					<div class="layui-progress layui-progress-big" lay-filter="demo"> <!-- lay-showPercent="true" -->
						<div class="layui-progress-bar" lay-percent="0%"></div>
					</div>
					<p class="forword">转换中...</p>
				</div>
				<p class="succmat"><i class="iconfont icon-11"></i>转换成功！</p>
				<input type="button" value="转换" class="layui-btn site-demo-active"  data-type="loading"/>
			</div>
		</div>
	</form>
</div>

	



<script type="text/javascript">
	$(document).ready(function(){
		$('#imparea').on('keyup', function() {  
		    $('.area-count .countnew').html($('#imparea').val().length);  
		});
		if($('.onearea').length <= 0){
			$('.gb-linetw').hide();
		}
		function toUploading(){
			var newDiv = '<div class="onearea">'+
						'<div class="thefile">'+
							'<div class="filename"><i class="iconfont icon-1"></i><span class="thename">杭州台风预警.mp3</span></div>'+
							'<div class="filebtn">'+
								'<input type="button" value="格式转换" class="foconv-btn"/>'+
								'<input type="button" value="转成文本" class="wordconv-btn" data-type="loading"/>'+
								'<input type="button" value="删除" class="todel-btn"/>'+
							'</div>'+
						'</div>'+
						'<div class="oneimp">'+
							'<div class="tomat theprog-bar">'+
								'<div class="layui-progress layui-progress-big" lay-filter="demo" lay-showPercent="true">'+
								  '<div class="layui-progress-bar" lay-percent="0%"></div>'+
								'</div>'+
								'<p class="forword">转换中...</p>'+
							'</div>'+
						'</div>'+
					'</div>';
			$('#upthefile').before(newDiv);
			$('.onearea').last().find('.thename').html(thefileName);
		}
		var thefileName;
		function theFile(){
			if(navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion.match(/9./i)=="9."){ 
				//alert("IE 9.0"); 
				var fileEle = document.getElementById('fileup');
	   	 		var fileObj = null;
				if(fileEle.files){
			        fileObj = fileEle.files[0];
			    }else{
			        var fso = new ActiveXObject("Scripting.FileSystemObject");
			
			        fileEle.select();
			        fileEle.blur();
			        var filePath = document.selection.createRange().text;
			
			        if(fso.FileExists(filePath)){
			            fileObj = fso.GetFile(filePath);
			        }
			        $('#upthefile').parent().find(' .thename').html(fileObj.name);
			        thefileName = fileObj.name;
			    }
			}else{
				var myfile = document.getElementById('fileup');  
		        var filename = myfile.files[0].name ;
				$('#upthefile').parent().find(' .thename').html(filename);
				 thefileName = filename;
			}
		}
		var thetext	= '<textarea class="imparea" onblur="if(!value){this.value = defaultValue;this.style.color = "#ccc"}">转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本转换的文本</textarea>';
		
		
		$(function() {
			$(document).on('click','.todel-btn',function(event) {
		        showDiv();
		        $(this).parents('.onearea').addClass('todel');
		        //$(myDiv).toggle();
		        $(document).one("click",
		        function() { 
		            $('.choose').hide();
		            $('.onearea').removeClass('todel');
		        });
		        event.stopPropagation(); 
		    });
		    
		    $('.choose').click(function(event) {
		        event.stopPropagation(); 
		    });
		});
		function showDiv() {
			var x = event.clientX - event.offsetX;
			var y = event.clientY - event.offsetY;
			$('.choose').css({'display':'block','top':y-90,'left':x-130});
		}

		$('.cho-delete').click(function(){
			$('.choose').hide();
			$('.onearea.todel').remove();
			if($('.onearea').length <= 0){
				$('.gb-linetw').hide();
			}
		})
		$('.cho-cancel').click(function(){
			$('.choose').hide();
			$('.onearea').removeClass('todel');
		})

		$('.gb-main-item').scroll(function(){
			if($('.choose').is(':visible')){
				$('.choose').hide();
				$('.filelist li').removeClass('todel');
			}
		})

		var uncH = parseInt($('.uncont').css('height'));
		$('.unreason').css({'height':uncH+45,'margin-top':-(uncH+45)/2});

		$(document).on('click','.toswitch',function(){
			$('.popwindow').show();
			$('.toshift').show();
			$('.matlist li ').eq(0).find('input').prop('checked',true);
			$('.uncont .succmat').hide();
		})

		$(document).on('click','.foconv-btn',function(){
			$('.popwindow').show();
			$('.toshift').show();
			$('.matlist li ').eq(0).find('input').prop('checked',true);
			$('.uncont .succmat').hide();
		})
		
		


		layui.use(['form', 'element'], function(){
			var element = layui.element //Tab的切换功能，切换事件监听等，需要依赖element模块
			,form = layui.form;
			form.render();

			var itbtn = $('<span class="itbtn"></span>');
			$('.layui-select-title').append(itbtn);
			$('.gb-form .layui-form-radio').remove();

		  
			//触发事件
			var active = {
			    loading: function(othis){
			      var DISABLED = 'layui-btn-disabled';
			      if(othis.hasClass(DISABLED)) return;
			      
			      //模拟loading
			      var n = 0,timer = setInterval(function(){
			        n = n + Math.random()*10|0;  
			        if(n>100){
			          n = 100;
			          clearInterval(timer);
			          othis.removeClass(DISABLED);
			          $('.wordconv-btn').removeClass(DISABLED);
			          $('.Albeenconv').addClass(DISABLED);
			          $('.uncont .tomat').hide();
			          $('.uncont .succmat').show();
			         
			          /**/if($('#upthefile').is(':visible')){
						$('#upthefile').hide();
			        	toUploading();
			          }

			          $('.theload').find('.tomat.theprog-bar').hide();
			          $('.theload').append(thetext);
			          $('.theload').find('.imparea').show();
			          $('.onearea').removeClass('theload');
			        }
			        element.progress('demo', n+'%');
			      }, 300+Math.random()*1000);
			      
			      othis.addClass(DISABLED);
			      $('.wordconv-btn').addClass(DISABLED);
			    }
			};
		  	

			$('.site-demo-active').on('click', function(){
				$('.uncont .tomat').show();
				$('.uncont .succmat').hide();
				var othis = $(this), type = $(this).data('type');
				console.log(othis);
				active[type] ? active[type].call(this, othis) : '';
			});
			$(document).on('click','.wordconv-btn', function(){
				if($(this).hasClass('layui-btn-disabled')){
					return
				}else{
					$(this).addClass('Albeenconv');
					$(this).parents('.onearea').find('.tomat.theprog-bar').show();
					$(this).parents('.onearea').addClass('theload');
					var othis = $(this), type = $(this).data('type');
					active[type] ? active[type].call(this, othis) : '';
				}
				
			});/**/
			/**/$('.fileup').change(function(){
				$('.gb-linetw').show();
				$('#upthefile').show();
				
				var othis = $(this), type = $(this).data('type');
				active[type] ? active[type].call(this, othis) : '';
				theFile();
			})
		});
	})
	
</script>